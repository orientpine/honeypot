# Output Structure Guide

Paper Style Generator가 생성하는 하이브리드 아키텍처 스킬 세트의 구조 가이드입니다.

## 1. 출력 위치

생성된 스킬은 다음 위치에 저장됩니다:

```
~/.claude/skills/{alias}-paper-skills/
```

예: `~/.claude/skills/hakho-paper-skills/`

---

## 2. 디렉토리 구조 (Hybrid Architecture)

```
{alias}-paper-skills/
├── agents/                              # 9 Agents
│   ├── {alias}-paper-orchestrator.md    # 전체 논문 자동 생성 + 전파 관리
│   ├── {alias}-title-writer.md          # Title 작성 + 수정
│   ├── {alias}-abstract-writer.md       # Abstract 작성 + 수정
│   ├── {alias}-introduction-writer.md   # Introduction 작성 + 수정
│   ├── {alias}-methodology-writer.md    # Methodology 작성 + 수정
│   ├── {alias}-results-writer.md        # Results 작성 + 수정
│   ├── {alias}-discussion-writer.md     # Discussion 작성 + 수정
│   ├── {alias}-caption-writer.md        # Figure/Table Caption 작성 + 수정
│   └── {alias}-verify.md                # 일관성 검증 + 보고
│
├── skills/
│   └── {alias}-style-guide/             # Single Source of Truth
│       ├── SKILL.md                     # 메인 스타일 가이드 (진입점)
│       └── references/                  # 11 Reference Files
│           ├── voice-tense-patterns.md
│           ├── vocabulary-patterns.md
│           ├── measurement-formats.md
│           ├── citation-style.md
│           ├── title-template.md
│           ├── abstract-template.md
│           ├── introduction-template.md
│           ├── methodology-template.md
│           ├── results-template.md
│           ├── discussion-template.md
│           └── caption-template.md
│
├── .claude-plugin/
│   └── marketplace.json                 # 플러그인 등록 (agents[] + skills[])
│
└── README.md                            # 사용 가이드
```

---

## 3. 파일 설명

### 3.1 marketplace.json

```json
{
  "name": "{alias}-paper-skills",
  "owner": {
    "name": "Auto-generated by Paper Style Generator"
  },
  "metadata": {
    "version": "1.0.0",
    "description": "...",
    "generated": "2026-01-12T00:00:00",
    "source_papers": 12,
    "confidence": 0.85
  },
  "agents": [
    "./agents/{alias}-paper-orchestrator.md",
    "./agents/{alias}-title-writer.md",
    "./agents/{alias}-abstract-writer.md",
    "./agents/{alias}-introduction-writer.md",
    "./agents/{alias}-methodology-writer.md",
    "./agents/{alias}-results-writer.md",
    "./agents/{alias}-discussion-writer.md",
    "./agents/{alias}-caption-writer.md",
    "./agents/{alias}-verify.md"
  ],
  "skills": [
    "./skills/{alias}-style-guide"
  ]
}
```

### 3.2 Agent 파일 구조

각 Agent는 독립적인 `.md` 파일로 존재하며, 다음 요소를 포함합니다:

**필수 요소**:
- Frontmatter (name, description, tools, model)
- Role & Responsibilities
- Input/Output Schema
- Workflow Steps
- Style Guide Reference (항상 `{alias}-style-guide` 참조)
- Error Handling

**예시 (title-writer.md)**:
```yaml
---
name: {alias}-title-writer
description: "논문 제목 작성 및 수정 전문 에이전트"
tools: Read, Write, Edit, AskUserQuestion
model: opus
---

# {alias} Title Writer

## Role
논문 제목 작성 및 수정을 담당합니다.

## Style Guide Reference
- `skills/{alias}-style-guide/references/title-template.md`
- `skills/{alias}-style-guide/references/vocabulary-patterns.md`

...
```

### 3.3 SKILL.md (Style Guide)

`skills/{alias}-style-guide/SKILL.md`는 모든 Agent가 참조하는 **Single Source of Truth**입니다.

**필수 요소**:
- Frontmatter (name, description)
- Style Overview (voice, tense, length)
- Key Writing Patterns
- Transformation Examples
- Anti-Patterns
- Reference Files Index

---

## 4. Reference Files (11개)

모든 Reference 파일은 `skills/{alias}-style-guide/references/` 디렉토리에 **플랫 구조**로 저장됩니다.

### 4.1 공통 스타일 파일 (4개)

| 파일 | 내용 |
|------|------|
| `voice-tense-patterns.md` | Active/Passive 비율, 시제 패턴 |
| `vocabulary-patterns.md` | 고빈도 학술 동사, 전환어 |
| `measurement-formats.md` | 측정값 표기법, 단위 |
| `citation-style.md` | 인용 스타일 (APA, Vancouver 등) |

### 4.2 섹션별 템플릿 (7개)

| 파일 | 내용 |
|------|------|
| `title-template.md` | 제목 패턴 분석 |
| `abstract-template.md` | Abstract 구조 템플릿 |
| `introduction-template.md` | Introduction 구조 템플릿 |
| `methodology-template.md` | Methodology 구조 템플릿 |
| `results-template.md` | Results 구조 템플릿 |
| `discussion-template.md` | Discussion 구조 템플릿 |
| `caption-template.md` | Figure/Table Caption 템플릿 |

---

## 5. 등록 및 사용

### 5.1 플러그인 등록

```bash
# Claude Code에서 실행
/plugin marketplace add ~/.claude/skills/{alias}-paper-skills
```

### 5.2 Agent 사용

**전체 논문 자동 생성:**
```
@{alias}-paper-orchestrator 논문을 작성해줘
```

**개별 섹션 작성:**
```
@{alias}-title-writer 제목을 작성해줘
@{alias}-abstract-writer Abstract를 작성해줘
@{alias}-introduction-writer Introduction을 작성해줘
@{alias}-methodology-writer Methodology를 작성해줘
@{alias}-results-writer Results를 작성해줘
@{alias}-discussion-writer Discussion을 작성해줘
@{alias}-caption-writer Figure 1 캡션을 작성해줘
```

**검증:**
```
@{alias}-verify 논문 일관성을 검증해줘
```

### 5.3 Style Guide 참조

Agent가 자동으로 참조하지만, 직접 확인도 가능합니다:

```
/{alias}-style-guide
```

### 5.4 플러그인 제거

```bash
/plugin marketplace remove {alias}-paper-skills
```

---

## 6. 커스터마이징

### 6.1 스타일 수정

생성된 스킬을 수정하려면:

1. `~/.claude/skills/{alias}-paper-skills/` 로 이동
2. Style Guide 수정: `skills/{alias}-style-guide/SKILL.md`
3. Reference 파일 수정: `skills/{alias}-style-guide/references/*.md`
4. Agent 수정 (선택): `agents/{alias}-*-writer.md`

### 6.2 새 패턴 추가

`skills/{alias}-style-guide/references/` 폴더에 새로운 패턴 파일을 추가할 수 있습니다.

**예시:**
```bash
# 새 Reference 파일 추가
vim skills/{alias}-style-guide/references/custom-pattern.md

# SKILL.md에 참조 추가
vim skills/{alias}-style-guide/SKILL.md
```

### 6.3 Agent 동작 수정

특정 Agent의 동작을 변경하려면:

```bash
# 예: Title Writer의 워크플로우 수정
vim agents/{alias}-title-writer.md
```

### 6.4 주의사항

- `marketplace.json`의 구조는 수정하지 마세요
- `agents[]` 배열과 `skills[]` 배열을 유지하세요
- 파일명에 특수문자를 사용하지 마세요
- Agent 파일 추가/삭제 시 `marketplace.json` 동기화 필수

---

## 7. 아키텍처 특징

### 7.1 Hybrid Architecture 장점

| 구성 요소 | 역할 | 장점 |
|----------|------|------|
| **Agents** (9개) | 독립적인 작업 수행 | 병렬 실행, 컨텍스트 격리 |
| **Skill** (1개) | 공통 스타일 가이드 | Single Source of Truth, 일관성 보장 |
| **References** (11개) | 상세 패턴 문서 | Agent가 필요 시 참조 |

### 7.2 Agent 간 협업

```
[Orchestrator]
     │
     ├─► [Title Writer] ──┐
     ├─► [Abstract Writer] ┤
     ├─► [Intro Writer]    ├─► [Verify] ──► 최종 검증
     ├─► [Method Writer]   │
     ├─► [Results Writer]  │
     ├─► [Discussion Writer]┤
     └─► [Caption Writer] ─┘
           │
           └─► 모두 {alias}-style-guide 참조
```

### 7.3 버전 관리

`marketplace.json`의 `metadata.version`에 버전이 기록됩니다.

### 7.4 재생성

동일한 alias로 재생성하면 기존 스킬이 덮어쓰기됩니다.
백업이 필요한 경우 먼저 복사하세요.

```bash
# 백업 예시
cp -r ~/.claude/skills/{alias}-paper-skills \
      ~/.claude/skills/{alias}-paper-skills.backup
```

---

## 8. 문제 해결

### 8.1 Agent가 인식되지 않음

```bash
# 캐시 클리어
Remove-Item -Recurse -Force "$env:USERPROFILE\.claude\plugins\cache"

# 재등록
/plugin marketplace remove {alias}-paper-skills
/plugin marketplace add ~/.claude/skills/{alias}-paper-skills
```

**체크리스트:**
- [ ] `marketplace.json`에 `agents[]` 배열이 있는가?
- [ ] 모든 Agent 파일이 `agents/` 디렉토리에 있는가?
- [ ] Agent 파일명이 `marketplace.json`과 일치하는가?

### 8.2 YAML 파싱 오류

- Agent `.md` 파일의 description에 작은따옴표가 있으면 큰따옴표로 감싸세요
- 줄바꿈은 LF만 사용하세요 (CRLF 금지)

```bash
# CRLF → LF 변환 (Linux/Mac)
find agents/ -name "*.md" -exec dos2unix {} \;

# Windows (PowerShell)
Get-ChildItem agents/*.md | ForEach-Object {
  (Get-Content $_.FullName -Raw) -replace "`r`n", "`n" | Set-Content $_.FullName -NoNewline
}
```

### 8.3 경로 오류

**올바른 경로:**
```json
{
  "agents": [
    "./agents/{alias}-paper-orchestrator.md",
    "./agents/{alias}-title-writer.md"
  ],
  "skills": [
    "./skills/{alias}-style-guide"
  ]
}
```

**잘못된 경로:**
```json
{
  "agents": [
    "./agents/"  // ❌ 디렉토리만 지정 불가
  ],
  "skills": [
    "./skills/{alias}-style-guide/",  // ❌ trailing slash
    "./skills/{alias}-style-guide/SKILL.md"  // ❌ 파일 직접 지정
  ]
}
```

### 8.4 Agent가 Style Guide를 찾지 못함

Agent 파일에서 다음 경로를 확인하세요:

```markdown
## Style Guide Reference
- `skills/{alias}-style-guide/SKILL.md`
- `skills/{alias}-style-guide/references/title-template.md`
```

**절대 경로 사용 금지:**
```markdown
❌ `~/.claude/skills/{alias}-paper-skills/skills/{alias}-style-guide/SKILL.md`
✅ `skills/{alias}-style-guide/SKILL.md`
```
